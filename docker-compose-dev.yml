version: '2'
services:
  config:
    image: garystafford/config-server:latest
    ports:
      - "8888:8888"
    expose:
      - "8888"
    hostname: "config"
    container_name: "config"
    environment:
      - SPRING_PROFILES_ACTIVE=development

  eureka:
    image: garystafford/eureka-server:latest
    ports:
      - "8761:8761"
    expose:
      - "8761"
    depends_on:
      - config
    links:
      - config
    hostname: "eureka"
    container_name: "eureka"
    environment:
      - SPRING_PROFILES_ACTIVE=development
      - CONFIG_SERVER_URL=http://config:8888

  mongodb:
    image: mongo:latest
    ports:
      - "27018:27017"
    volumes:
      - /data:/data/db
    restart: always
    hostname: "mongodb"
    container_name: "mongodb"
    command: --smallfiles --rest --auth

  widget:
    image: garystafford/widget-service:latest
    ports:
      - "8030:8030"
    depends_on:
      - config
      - eureka
      - mongodb
    links:
      - config
      - eureka
    hostname: "widget"
    container_name: "widget"
    environment:
      - SPRING_PROFILES_ACTIVE=development
      - CONFIG_SERVER_URL=http://config:8888

  user:
    image: garystafford/user-service:latest
    ports:
      - "8031:8031"
    depends_on:
      - config
      - eureka
      - mongodb
    links:
      - config
      - eureka
    hostname: "user"
    container_name: "user"
    environment:
      - SPRING_PROFILES_ACTIVE=development
      - CONFIG_SERVER_URL=http://config:8888

volumes:
  data:
    # external: true
